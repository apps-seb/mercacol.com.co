<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercacol - Encuesta App Tenderos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <!-- jsPDF and xlsx libraries for export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        input[type="radio"]:checked,
        input[type="checkbox"]:checked {
            background-color: #22C55E; /* green-500 */
            border-color: #16A34A; /* green-700 */
        }
        
        .survey-container {
            position: relative;
            min-height: 480px;
            height: auto;
            overflow: hidden;
        }

        .survey-step {
            width: 100%;
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
        }

        .step-hidden {
            opacity: 0;
            transform: translateX(30px);
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .step-visible {
            opacity: 1;
            transform: translateX(0);
            position: relative;
        }

        .form-input-glass {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: transparent;
        }
        .form-input-glass:focus {
            --tw-ring-color: #4ade80;
            border-color: #4ade80;
        }
        .form-input-glass option {
            background-color: #1F2937;
            color: white;
        }
        
        .form-input-glass-card {
             background-color: transparent;
             border: none;
        }
        .form-input-glass-card:focus {
            --tw-ring-color: transparent;
        }

        .demo-mockup {
            width: 100%;
            min-height: 16rem;
            height: auto;
            background-color: rgba(31, 41, 55, 0.5);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }

        .timeline-item {
            transition: opacity 0.5s, transform 0.5s;
        }

        .timeline-icon {
            transition: background-color 0.3s;
        }

        .timeline-item svg {
            transition: color 0.3s;
        }

        .timeline-connector {
            position: relative;
        }
        .timeline-connector::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 100%;
            background-color: #22C55E; /* green-500 */
            transition: width 0.5s ease-in-out;
        }
        .timeline-connector.completed::after {
            width: 100%;
        }

        .timeline-node, .timeline-label {
            transition: all 0.5s ease-in-out;
        }

        .timeline-item-vertical {
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .timeline-icon-vertical {
            transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .timeline-icon-vertical.active {
            background-color: #22C55E; /* green-500 */
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.6);
        }

        /* New Horizontal Timeline CSS */
        .timeline-horizontal-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 1rem 0;
            width: 100%;
        }
        .timeline-horizontal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1 1 0px;
            position: relative;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .timeline-node {
            width: 2.5rem; /* 40px */
            height: 2.5rem; /* 40px */
            border-radius: 9999px;
            background-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #4B5563; /* gray-600 */
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
        }
        .timeline-node.active {
            background-color: #22C55E; /* green-500 */
            border-color: #22C55E;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.6);
        }
        .timeline-node svg {
            width: 1.25rem;
            height: 1.25rem;
            color: #6B7280; /* gray-500 */
            transition: color 0.4s ease;
        }
        .timeline-node.active svg {
            color: white;
        }
        .timeline-label {
            margin-top: 0.75rem;
            font-size: 0.75rem; /* 12px */
            line-height: 1rem; /* 16px */
            text-align: center;
            width: 5rem; /* 80px */
            color: #9CA3AF; /* gray-400 */
            transition: color 0.4s ease;
        }
        .timeline-label.active {
            color: white;
            font-weight: 700;
        }
        .timeline-connector {
            position: absolute;
            top: 2.5rem; /* Positioned at the bottom of the node */
            left: 50%;
            width: calc(100% - 2.5rem); /* Adjust width to connect nodes */
            height: 2px;
            background-color: #4B5563; /* gray-600 */
            z-index: 5;
        }
        .timeline-connector-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 100%;
            background-color: #22C55E; /* green-500, solid color */
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 9999px;
        }
        .timeline-horizontal-item:first-child .timeline-connector {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        .view-section {
            animation: fadeIn 0.4s ease-in-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-gray-900 to-green-900 min-h-screen flex items-center justify-center p-4 pb-28 text-white">

    <div id="survey-wrapper" class="view-section bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl max-w-lg w-full overflow-hidden border border-white/20">
        
        <header class="p-6 border-b border-white/20 flex items-center space-x-4">
            <svg class="w-10 h-10 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
            <div>
                <h1 class="text-2xl font-bold text-white">Mercacol</h1>
                <p class="text-sm text-green-400">La nueva era para tu tienda</p>
            </div>
        </header>

        <div class="w-full bg-white/10 h-2">
            <div id="progress-bar" class="h-2 bg-green-500 transition-all duration-500" style="width: 0%;"></div>
        </div>

        <main class="p-8 survey-container">
            
            <div id="step-1" class="survey-step step-hidden">
                <h2 class="text-3xl font-bold mb-4">¡Hola, tendero de Popayán!</h2>
                <p class="text-gray-200 mb-6">Queremos revolucionar la forma en que surtes tu negocio. Queremos ahorrarte tiempo y dinero con nuestra nueva app.</p>
                <p class="text-gray-200 mb-8">¿Nos regalas 2 minutos de tu tiempo? Tu opinión es clave.</p>
            </div>
            
            <div id="step-2" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">1. ¿Cómo compras actualmente los productos agrícolas para tu tienda?</h3>
                <div class="space-y-4">
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="habitos" value="plaza" class="w-5 h-5 accent-green-500 rounded">
                        <span>Voy personalmente a la central de abastos (Plaza).</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="habitos" value="proveedores" class="w-5 h-5 accent-green-500 rounded">
                        <span>Tengo proveedores fijos que me visitan.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="habitos" value="telefono" class="w-5 h-5 accent-green-500 rounded">
                        <span>Hago pedidos por teléfono o WhatsApp.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="habitos" value="otro" class="w-5 h-5 accent-green-500 rounded">
                        <span>Otro método.</span>
                    </label>
                </div>
            </div>

            <div id="step-3" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">2. ¿Cuál es tu mayor desafío al comprar?</h3>
                <div class="space-y-4">
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="desafio" value="tiempo" class="w-5 h-5 accent-green-500">
                        <span>La pérdida de tiempo (transporte, trancones, buscar).</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="desafio" value="precios" class="w-5 h-5 accent-green-500">
                        <span>Precios injustos o que cambian mucho.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="desafio" value="calidad" class="w-5 h-5 accent-green-500">
                        <span>La calidad de los productos no es consistente.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="desafio" value="horarios" class="w-5 h-5 accent-green-500">
                        <span>Tener que madrugar o ir en horarios difíciles.</span>
                    </label>
                </div>
            </div>

            <div id="step-4" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">3. ¿En qué barrio de Popayán está tu tienda?</h3>
                <p class="text-sm text-gray-300 mb-4">Esto nos ayudará a planificar nuestras rutas de entrega.</p>
                <select name="ubicacion" class="w-full p-3 rounded-lg border outline-none placeholder-gray-300 text-white form-input-glass ring-1 ring-transparent focus:ring-green-400">
                    <option value="" disabled selected>Selecciona tu barrio</option>
                    <optgroup label="Comuna 1">
                        <option value="Modelo">Modelo</option>
                        <option value="Loma Linda">Loma Linda</option>
                        <option value="Prados del Norte">Prados del Norte</option>
                        <option value="La Cabaña">La Cabaña</option>
                        <option value="Santa Clara">Santa Clara</option>
                        <option value="Casas Fiscales">Casas Fiscales</option>
                        <option value="Nueva Granada">Nueva Granada</option>
                        <option value="Machangara">Machangara</option>
                        <option value="La Playa">La Playa</option>
                        <option value="Campamento">Campamento</option>
                        <option value="Puerta de Hierro">Puerta de Hierro</option>
                        <option value="Catay">Catay</option>
                        <option value="Antonio Nariño">Antonio Nariño</option>
                        <option value="Villa Paola">Villa Paola</option>
                        <option value="Campo Bello">Campo Bello</option>
                        <option value="El recuerdo">El recuerdo</option>
                        <option value="La Villa">La Villa</option>
                        <option value="Bloques de Pubenza">Bloques de Pubenza</option>
                        <option value="Belalcázar">Belalcázar</option>
                        <option value="Los Laureles">Los Laureles</option>
                        <option value="Los Rosales">Los Rosales</option>
                        <option value="Alcalá">Alcalá</option>
                        <option value="Monte Rosales">Monte Rosales</option>
                        <option value="Fancal Capri">Fancal Capri</option>
                        <option value="Maria Alejandra">Maria Alejandra</option>
                        <option value="Navarra">Navarra</option>
                        <option value="Cerritos de la Paz">Cerritos de la Paz</option>
                    </optgroup>
                    <optgroup label="Comuna 2">
                        <option value="Villa Melisa">Villa Melisa</option>
                        <option value="Esperanza">Esperanza</option>
                        <option value="Canterbury">Canterbury</option>
                        <option value="La Arboleda">La Arboleda</option>
                        <option value="El Uvo">El Uvo</option>
                        <option value="San Ignacio">San Ignacio</option>
                        <option value="Bella Vista">Bella Vista</option>
                        <option value="El Bambú">El Bambú</option>
                        <option value="Cruz Roja">Cruz Roja</option>
                        <option value="Río Vista">Río Vista</option>
                        <option value="Bello Horizonte">Bello Horizonte</option>
                        <option value="El Placer">El Placer</option>
                        <option value="Villa del Norte">Villa del Norte</option>
                        <option value="La Primavera">La Primavera</option>
                        <option value="Rinconcito Primaveral">Rinconcito Primaveral</option>
                        <option value="La Florida">La Florida</option>
                        <option value="Barrio González">Barrio González</option>
                        <option value="El Tablazo">El Tablazo</option>
                        <option value="Morinda">Morinda</option>
                        <option value="Destechados">Destechados</option>
                        <option value="Santiago de Cali">Santiago de Cali</option>
                        <option value="Zuldemaida">Zuldemaida</option>
                        <option value="María Paz">María Paz</option>
                        <option value="Balcón Norte">Balcón Norte</option>
                        <option value="Pino Pardo">Pino Pardo</option>
                        <option value="Matamoros">Matamoros</option>
                        <option value="Chamizal">Chamizal</option>
                        <option value="Tóez">Tóez</option>
                        <option value="Villa Claudia">Villa Claudia</option>
                        <option value="Guayacanes del Río">Guayacanes del Río</option>
                        <option value="Pinar">Pinar</option>
                        <option value="Los Cámbulos">Los Cámbulos</option>
                        <option value="Luna Blanca">Luna Blanca</option>
                        <option value="Cordillera">Cordillera</option>
                        <option value="Villa del Viento">Villa del Viento</option>
                        <option value="Pinares Canal de Brujas">Pinares Canal de Brujas</option>
                        <option value="Los Ángeles">Los Ángeles</option>
                        <option value="Galilea">Galilea</option>
                        <option value="Atardeceres de la Pradera">Atardeceres de la Pradera</option>
                        <option value="Pinos Llano">Pinos Llano</option>
                        <option value="Nueva Alianza">Nueva Alianza</option>
                        <option value="Pinares del Río">Pinares del Río</option>
                        <option value="Nuevo Tequendama">Nuevo Tequendama</option>
                        <option value="Rincón de la Aldea">Rincón de la Aldea</option>
                        <option value="Trece de Octubre">Trece de Octubre</option>
                        <option value="San Gerardo">San Gerardo</option>
                        <option value="Bosques del Pinar">Bosques del Pinar</option>
                        <option value="Quintas de José Miguel">Quintas de José Miguel</option>
                        <option value="Minuto de Dios">Minuto de Dios</option>
                        <option value="Divino Niño">Divino Niño</option>
                        <option value="Álamos del Norte">Álamos del Norte</option>
                        <option value="Villa Diana">Villa Diana</option>
                        <option value="Renacer">Renacer</option>
                        <option value="El Encanto">El Encanto</option>
                        <option value="San Fernando">San Fernando</option>
                        <option value="Rincón de Comfacauca">Rincón de Comfacauca</option>
                        <option value="Rinconcito Primaveral II">Rinconcito Primaveral II</option>
                        <option value="Capri">Capri</option>
                        <option value="Gran Bretaña">Gran Bretaña</option>
                    </optgroup>
                    <optgroup label="Comuna 3">
                        <option value="Bolívar">Bolívar</option>
                        <option value="Ciudad Jardín">Ciudad Jardín</option>
                        <option value="Periodistas">Periodistas</option>
                        <option value="Sotará">Sotará</option>
                        <option value="Deportistas">Deportistas</option>
                        <option value="Los Hoyos">Los Hoyos</option>
                        <option value="Yambitará">Yambitará</option>
                        <option value="Villa Mercedes">Villa Mercedes</option>
                        <option value="Yanaconas">Yanaconas</option>
                        <option value="La Ximena">La Ximena</option>
                        <option value="Palacé">Palacé</option>
                        <option value="Pueblillo">Pueblillo</option>
                        <option value="Vega de Prieto">Vega de Prieto</option>
                        <option value="José Antonio Galán">José Antonio Galán</option>
                        <option value="Tres Margaritas">Tres Margaritas</option>
                        <option value="Torres del Río">Torres del Río</option>
                        <option value="Galicia">Galicia</option>
                        <option value="Nuevo Yambitará">Nuevo Yambitará</option>
                        <option value="La Virginia">La Virginia</option>
                        <option value="Rincón de la Estancia">Rincón de la Estancia</option>
                        <option value="Moravia">Moravia</option>
                        <option value="Aida Lucía">Aida Lucía</option>
                        <option value="Alicante">Alicante</option>
                        <option value="Acacias">Acacias</option>
                        <option value="Ucrania">Ucrania</option>
                        <option value="Rincón del Río">Rincón del Río</option>
                        <option value="Chicalá">Chicalá</option>
                        <option value="La Estancia">La Estancia</option>
                        <option value="Rincón de la Ximena">Rincón de la Ximena</option>
                        <option value="Recodo del Río">Recodo del Río</option>
                        <option value="Urbanización Yanaconas">Urbanización Yanaconas</option>
                        <option value="Altos del Río">Altos del Río</option>
                        <option value="Poblados de San Miguel">Poblados de San Miguel</option>
                        <option value="Portales del Norte">Portales del Norte</option>
                        <option value="Rincón de Yambitará">Rincón de Yambitará</option>
                        <option value="Arcos de Yanaconas">Arcos de Yanaconas</option>
                        <option value="La Floresta">La Floresta</option>
                        <option value="Portón de Palacé">Portón de Palacé</option>
                        <option value="Molinos de la Estancia">Molinos de la Estancia</option>
                        <option value="Villa Alicia">Villa Alicia</option>
                        <option value="Portal de la Vega">Portal de la Vega</option>
                        <option value="Portón de la Hacienda">Portón de la Hacienda</option>
                        <option value="La Cristina">La Cristina</option>
                        <option value="Poblado de San Esteban">Poblado de San Esteban</option>
                        <option value="Real Independencia">Real Independencia</option>
                        <option value="El Recuerdo I">El Recuerdo I</option>
                        <option value="Villa del Prado">Villa del Prado</option>
                    </optgroup>
                    <optgroup label="Comuna 4">
                        <option value="Cadillal">Cadillal</option>
                        <option value="Valencia">Valencia</option>
                        <option value="El Achiral">El Achiral</option>
                        <option value="Las Américas">Las Américas</option>
                        <option value="Colombia I Etapa">Colombia I Etapa</option>
                        <option value="Argentina">Argentina</option>
                        <option value="San Camilo">San Camilo</option>
                        <option value="El Empedrado">El Empedrado</option>
                        <option value="Hernando Lora">Hernando Lora</option>
                        <option value="Moscopán">Moscopán</option>
                        <option value="Obrero">Obrero</option>
                        <option value="Santa Inés">Santa Inés</option>
                        <option value="Fucha">Fucha</option>
                        <option value="Loma de Cartagena">Loma de Cartagena</option>
                        <option value="La Pamba">La Pamba</option>
                        <option value="El Liceo">El Liceo</option>
                        <option value="Caldas">Caldas</option>
                        <option value="El Refugio">El Refugio</option>
                        <option value="San Rafael">San Rafael</option>
                        <option value="Los Álamos">Los Álamos</option>
                        <option value="Centro">Centro</option>
                        <option value="Siglo xx">Siglo xx</option>
                        <option value="El Prado">El Prado</option>
                        <option value="Vásquez Cobo">Vásquez Cobo</option>
                        <option value="Santa Teresita">Santa Teresita</option>
                        <option value="Pomona">Pomona</option>
                        <option value="Bosques de Pomona">Bosques de Pomona</option>
                        <option value="Portales del Río">Portales del Río</option>
                        <option value="Santa Catalina">Santa Catalina</option>
                        <option value="Belén">Belén</option>
                        <option value="Villa Helena">Villa Helena</option>
                        <option value="Fundecur">Fundecur</option>
                        <option value="Provitec II Etapa">Provitec II Etapa</option>
                    </optgroup>
                    <optgroup label="Comuna 5">
                        <option value="Avelino Ull">Avelino Ull</option>
                        <option value="Los Braseros">Los Braseros</option>
                        <option value="El Lago">El Lago</option>
                        <option value="Berlín">Berlín</option>
                        <option value="Suizo">Suizo</option>
                        <option value="Las Ferias">Las Ferias</option>
                        <option value="La Campiña">La Campiña</option>
                        <option value="María Oriente">María Oriente</option>
                        <option value="Los Sauces">Los Sauces</option>
                        <option value="Santa Mónica">Santa Mónica</option>
                        <option value="La Floresta">La Floresta</option>
                        <option value="Los Andes">Los Andes</option>
                        <option value="Colgate Palmolive">Colgate Palmolive</option>
                        <option value="Alameda">Alameda</option>
                        <option value="Plateado">Plateado</option>
                        <option value="Poblado Alto">Poblado Alto</option>
                        <option value="Alto de Pubenza">Alto de Pubenza</option>
                        <option value="Villa Oriente">Villa Oriente</option>
                    </optgroup>
                    <optgroup label="Comuna 6">
                        <option value="Nueva Granada">Nueva Granada</option>
                        <option value="San Rafael">San Rafael</option>
                        <option value="Samuel Silverio">Samuel Silverio</option>
                        <option value="Camino Real">Camino Real</option>
                        <option value="Nuevo Deán">Nuevo Deán</option>
                        <option value="El Salvador">El Salvador</option>
                        <option value="Santa Rita">Santa Rita</option>
                        <option value="San José de los Tejares">San José de los Tejares</option>
                        <option value="Pajonal">Pajonal</option>
                        <option value="Santa Fe">Santa Fe</option>
                        <option value="La Ladera">La Ladera</option>
                        <option value="José Hilario López">José Hilario López</option>
                        <option value="Valparaíso">Valparaíso</option>
                        <option value="Primero de Mayo">Primero de Mayo</option>
                        <option value="Los Comuneros">Los Comuneros</option>
                        <option value="Loma de la Virgen">Loma de la Virgen</option>
                        <option value="Sindical II">Sindical II</option>
                        <option value="Alfonso López">Alfonso López</option>
                        <option value="Calicanto">Calicanto</option>
                        <option value="Gabriel García Márquez">Gabriel García Márquez</option>
                        <option value="El Boquerón">El Boquerón</option>
                        <option value="Jorge Eliécer Gaitán">Jorge Eliécer Gaitán</option>
                        <option value="El Limonar">El Limonar</option>
                        <option value="La Paz Sur">La Paz Sur</option>
                        <option value="La Gran Victoria">La Gran Victoria</option>
                        <option value="Versalles II">Versalles II</option>
                        <option value="Villa del Carmen">Villa del Carmen</option>
                        <option value="Colina">Colina</option>
                        <option value="Nuevo Japón">Nuevo Japón</option>
                        <option value="Nuevo País">Nuevo País</option>
                        <option value="Tejares de Otón">Tejares de Otón</option>
                        <option value="Veraneras">Veraneras</option>
                        <option value="Villareal">Villareal</option>
                        <option value="Villa del Sur">Villa del Sur</option>
                        <option value="Palermo">Palermo</option>
                        <option value="Villa Hermosa">Villa Hermosa</option>
                        <option value="Nueva Frontera">Nueva Frontera</option>
                        <option value="El Recuerdo">El Recuerdo</option>
                        <option value="Colinas de Calicanto">Colinas de Calicanto</option>
                    </optgroup>
                    <optgroup label="Comuna 7">
                        <option value="Nazaret">Nazaret</option>
                        <option value="Isabela">Isabela</option>
                        <option value="Las Palmas I y II">Las Palmas I y II</option>
                        <option value="Colombia II Etapa">Colombia II Etapa</option>
                        <option value="Campos">Campos</option>
                        <option value="Treinta y Uno de Marzo">Treinta y Uno de Marzo</option>
                        <option value="El Mirador">El Mirador</option>
                        <option value="Tomas Cipriano de Mosquera">Tomas Cipriano de Mosquera</option>
                        <option value="Las Vegas">Las Vegas</option>
                        <option value="Solidaridad">Solidaridad</option>
                        <option value="Chapinero">Chapinero</option>
                        <option value="Retiro Alto">Retiro Alto</option>
                        <option value="Nuevo Popayán">Nuevo Popayán</option>
                        <option value="La Unión">La Unión</option>
                        <option value="La Libertad">La Libertad</option>
                        <option value="La Conquista">La Conquista</option>
                        <option value="Las Brisas">Las Brisas</option>
                        <option value="Independencia">Independencia</option>
                        <option value="Santa Librada">Santa Librada</option>
                        <option value="Villa del Carmen">Villa del Carmen</option>
                        <option value="Corsocial">Corsocial</option>
                        <option value="La Heroica">La Heroica</option>
                        <option value="Nuevo Hogar">Nuevo Hogar</option>
                        <option value="Santo Domingo Sabio I">Santo Domingo Sabio I</option>
                        <option value="Villas del Palmar">Villas del Palmar</option>
                        <option value="Villa Occidente">Villa Occidente</option>
                        <option value="Santo Domingo Sabio II">Santo Domingo Sabio II</option>
                        <option value="Villa España">Villa España</option>
                        <option value="San Fernando">San Fernando</option>
                        <option value="Panamericano">Panamericano</option>
                        <option value="Nuevo Milenio">Nuevo Milenio</option>
                        <option value="Los Álamos de Occidente">Los Álamos de Occidente</option>
                        <option value="Múnich">Múnich</option>
                        <option value="La Campiña">La Campiña</option>
                    </optgroup>
                    <optgroup label="Comuna 8">
                        <option value="Camilo Torres">Camilo Torres</option>
                        <option value="Junín">Junín</option>
                        <option value="Santa Elena">Santa Elena</option>
                        <option value="Popular">Popular</option>
                        <option value="Canadá">Canadá</option>
                        <option value="Llano Largo">Llano Largo</option>
                        <option value="José María Obando">José María Obando</option>
                        <option value="Minuto de Dios">Minuto de Dios</option>
                        <option value="Guayabal">Guayabal</option>
                        <option value="Esmeralda">Esmeralda</option>
                        <option value="Libertador">Libertador</option>
                        <option value="Pandiguando">Pandiguando</option>
                        <option value="La Isla">La Isla</option>
                        <option value="El Triunfo">El Triunfo</option>
                        <option value="Esperanza Sur">Esperanza Sur</option>
                        <option value="La Isla II">La Isla II</option>
                        <option value="Perpetuo Socorro">Perpetuo Socorro</option>
                        <option value="Junín II Etapa">Junín II Etapa</option>
                    </optgroup>
                    <optgroup label="Comuna 9">
                        <option value="Los Naranjos">Los Naranjos</option>
                        <option value="María Occidente">María Occidente</option>
                        <option value="Cinco de Abril">Cinco de Abril</option>
                        <option value="Nuevo Hogar">Nuevo Hogar</option>
                        <option value="Carlos Primero">Carlos Primero</option>
                        <option value="La Sombrilla">La Sombrilla</option>
                        <option value="San José">San José</option>
                        <option value="Kennedy">Kennedy</option>
                        <option value="San Antonio de Padua">San Antonio de Padua</option>
                        <option value="Capitana">Capitana</option>
                        <option value="Mis Ranchitos">Mis Ranchitos</option>
                        <option value="Lomas de Granada">Lomas de Granada</option>
                        <option value="Nuevo San José">Nuevo San José</option>
                        <option value="El Edén">El Edén</option>
                    </optgroup>
                    <option value="otro_barrio">Otro / Vereda</option>
                </select>
            </div>

            <div id="step-5" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">4. Pensando en la logística de Popayán, ¿qué horario de entrega prefieres?</h3>
                <div class="space-y-4">
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="horario" value="manana_temprano" class="w-5 h-5 accent-green-500">
                        <span>Temprano en la mañana (6:00 AM - 9:00 AM)</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="horario" value="media_manana" class="w-5 h-5 accent-green-500">
                        <span>Media mañana (9:00 AM - 12:00 PM)</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="horario" value="tarde" class="w-5 h-5 accent-green-500">
                        <span>En la tarde (1:00 PM - 4:00 PM)</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="horario" value="indiferente" class="w-5 h-5 accent-green-500">
                        <span>Me es indiferente mientras cumplan.</span>
                    </label>
                </div>
            </div>

            <div id="step-6" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">5. Nuestra idea: Una App Mercacol</h3>
                <p class="text-gray-200 mb-4">Estamos creando una app para que pidas todo desde tu celular, con precios justos y entrega en tu tienda.</p>
                <p class="text-gray-200 mb-6">Te mostraremos qué tan fácil será. <strong class="text-green-400">¡Sigue los pasos!</strong></p>
                <div class="demo-mockup">
                    <div class="w-full max-w-xs bg-gray-900 p-3 rounded-lg shadow-lg">
                        <div class="flex items-center space-x-2 mb-3">
                            <svg class="w-6 h-6 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                            <h4 class="font-bold">Mercacol</h4>
                        </div>
                        <div class="w-full h-20 bg-white/10 rounded flex items-center justify-center">
                            <p class="text-gray-300 text-sm">Tu mercado de confianza</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-7" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-4"><span class="text-green-400">Demo Paso 1:</span> Revisa los Precios del Día</h3>
                <p class="text-gray-200 mb-6">Estos son nuestros precios de hoy. ¡Siempre frescos, siempre justos!</p>
                <div class="demo-mockup">
                    <div class="w-full max-w-xs bg-gray-900/80 p-3 rounded-lg shadow-lg flex flex-col">
                        <h4 class="font-bold text-center mb-2 flex-shrink-0 text-green-400">Precios del Día</h4>
                        <div id="demo-price-list" class="space-y-1.5 text-sm">
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-8" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-4"><span class="text-green-400">Demo Paso 2:</span> Agrega Productos</h3>
                <p class="text-gray-200 mb-6">Ahora, simplemente toca los productos que necesitas de la lista.</p>
                <div class="demo-mockup">
                    <div class="w-full max-w-xs bg-gray-900 p-3 rounded-lg shadow-lg flex flex-col">
                        <div id="demo-product-list" class="space-y-2">
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-9" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-4"><span class="text-green-400">Demo Paso 3:</span> Selecciona la Cantidad</h3>
                <p class="text-gray-200 mb-6">Ajusta las libras o kilos que necesites. Sin compliques.</p>
                <div class="demo-mockup">
                    <div class="w-full max-w-xs bg-gray-900 p-3 rounded-lg shadow-lg flex flex-col">
                        <div id="demo-quantity-adjuster" class="space-y-3">
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-10" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-4"><span class="text-green-400">Demo Paso 4:</span> Mira tu Resumen</h3>
                <p class="text-gray-200 mb-6">Revisas tu pedido y el total en tu carrito. Todo transparente.</p>
                <div class="demo-mockup">
                    <div class="w-full max-w-xs bg-gray-900 p-3 rounded-lg shadow-lg flex flex-col">
                        <h4 class="font-bold text-center mb-2 flex-shrink-0">Tu Pedido</h4>
                        <div id="demo-summary-list" class="space-y-2 text-sm">
                        </div>
                        <hr class="border-white/20 my-2 flex-shrink-0"/>
                        <div class="w-full flex justify-between items-center text-md flex-shrink-0">
                            <span class="font-bold">TOTAL:</span>
                            <span id="demo-summary-total" class="font-bold text-green-400 text-lg">$0</span>
                        </div>
                    </div>
                </div>
                <button id="btn-demo-summary-confirm" class="w-full mt-6 flex items-center justify-center space-x-2 font-bold py-3 px-8 rounded-full shadow-lg transform transition-all duration-300 bg-green-600 text-white hover:bg-green-700 hover:scale-105 active:scale-95 active:shadow-inner disabled:bg-green-700 disabled:scale-100 disabled:cursor-wait">
                    <span id="check-icon" class="hidden">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                    </span>
                    <span id="btn-confirm-text">Confirmar Pedido</span>
                </button>
            </div>

            <div id="step-11" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-4"><span class="text-green-400">Demo Paso 5:</span> Confirma tu Compra</h3>
                <p class="text-gray-200 mb-6">¡Un clic y listo! Nosotros nos encargamos del resto.</p>
                <div class="demo-mockup">
                    <div class="w-full max-w-xs bg-gray-900 p-3 rounded-lg shadow-lg flex flex-col justify-center items-center">
                        <p class="text-gray-300 text-center mb-4">¿Todo listo para enviar tu pedido?</p>
                        <button id="btn-demo-confirm" class="w-full font-bold py-3 px-6 rounded-full shadow-lg transform transition-all duration-300 bg-green-500 text-white hover:bg-green-600 hover:scale-105 active:scale-95 active:shadow-inner">
                            Confirmar y Enviar Pedido
                        </button>
                    </div>
                </div>
            </div>

            <div id="step-12" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-4"><span class="text-green-400">Demo Paso 6:</span> ¡Pedido en Camino!</h3>
                <p class="text-gray-200 mb-6">Así es como verás el estado de tu pedido en tiempo real.</p>
                <div class="demo-mockup p-4 flex flex-col items-center">
                    <div id="timeline-container-horizontal" class="w-full max-w-md bg-transparent rounded-lg mb-4">
                        <!-- Horizontal timeline will be injected here -->
                    </div>
                    <div id="delivery-time-container" class="w-full max-w-md text-center opacity-0 transition-opacity duration-500">
                        <!-- Delivery time will be injected here -->
                    </div>
                </div>
            </div>
            
            <div id="step-13" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">6. ¿Qué te pareció este flujo?</h3>
                <p class="text-gray-200 mb-6">Viendo lo fácil que sería, ¿qué tan útil te parecería esta solución?</p>
                <div class="space-y-4">
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="utilidad" value="muy_util" class="w-5 h-5 accent-green-500">
                        <span>Muy útil, me ahorraría mucho trabajo.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="utilidad" value="util" class="w-5 h-5 accent-green-500">
                        <span>Suena bien, la probaría.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="utilidad" value="dudas" class="w-5 h-5 accent-green-500">
                        <span>Tengo dudas, necesitaría mejorar algo.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="radio" name="utilidad" value="no_util" class="w-5 h-5 accent-green-500">
                        <span>No creo que la usaría.</span>
                    </label>
                </div>
            </div>

            <div id="step-14" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">7. ¿Qué sería lo MÁS importante para ti en la app final?</h3>
                <p class="text-sm text-gray-300 mb-4">(Elige hasta 3)</p>
                <div class="space-y-4">
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="importante" value="precio_justo" class="w-5 h-5 accent-green-500 rounded">
                        <span>Que los precios sean realmente justos y transparentes.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="importante" value="entrega" class="w-5 h-5 accent-green-500 rounded">
                        <span>Que la entrega sea rápida y el mismo día.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="importante" value="calidad" class="w-5 h-5 accent-green-500 rounded">
                        <span>Poder confiar 100% en la frescura y calidad del producto.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="importante" value="facil" class="w-5 h-5 accent-green-500 rounded">
                        <span>Que sea súper fácil de usar (como en el demo).</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="importante" value="promos" class="w-5 h-5 accent-green-500 rounded">
                        <span>Promociones y descuentos especiales.</span>
                    </label>
                </div>
            </div>

            <div id="step-15" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">8. Además de comprar, ¿qué otra función te gustaría tener en la app?</h3>
                <p class="text-sm text-gray-300 mb-4">(Elige las que quieras)</p>
                <div class="space-y-4">
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="funciones" value="credito" class="w-5 h-5 accent-green-500 rounded">
                        <span>Poder comprar a crédito (fiar).</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="funciones" value="inventario" class="w-5 h-5 accent-green-500 rounded">
                        <span>Herramientas para controlar mi inventario.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="funciones" value="promos_push" class="w-5 h-5 accent-green-500 rounded">
                        <span>Alertas de promociones y "gangas" del día.</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20">
                        <input type="checkbox" name="funciones" value="soporte" class="w-5 h-5 accent-green-500 rounded">
                        <span>Un chat de soporte rápido por si algo sale mal.</span>
                    </label>
                </div>
            </div>
            
            <div id="step-16" class="survey-step step-hidden">
                <h3 class="text-xl font-semibold mb-6">9. ¡Ya casi terminamos!</h3>
                <p class="text-gray-200 mb-6">Déjanos tu contacto para ser de los primeros en probar la app y recibir un <strong class="text-green-400">bono de bienvenida</strong>.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white/10 p-4 rounded-lg flex items-start space-x-4 md:col-span-2">
                        <svg class="w-6 h-6 text-green-400 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                        <div>
                            <label for="nombre_completo" class="text-sm font-semibold text-gray-300">Nombre completo</label>
                            <input type="text" id="nombre_completo" name="nombre_completo" placeholder="Ej: Ana María Pérez" class="w-full p-2 outline-none placeholder-gray-400 text-white form-input-glass-card">
                        </div>
                    </div>
                     <div class="bg-white/10 p-4 rounded-lg flex items-start space-x-4">
                         <svg class="w-6 h-6 text-green-400 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" /></svg>
                        <div>
                            <label for="whatsapp" class="text-sm font-semibold text-gray-300">WhatsApp</label>
                            <input type="tel" id="whatsapp" name="whatsapp" placeholder="300 123 4567" class="w-full p-2 outline-none placeholder-gray-400 text-white form-input-glass-card">
                        </div>
                    </div>
                     <div class="bg-white/10 p-4 rounded-lg flex items-start space-x-4">
                        <svg class="w-6 h-6 text-green-400 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                        <div>
                            <label for="email" class="text-sm font-semibold text-gray-300">Correo Electrónico</label>
                            <input type="email" id="email" name="email" placeholder="tu.correo@email.com" class="w-full p-2 outline-none placeholder-gray-400 text-white form-input-glass-card" required>
                        </div>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg flex items-start space-x-4 md:col-span-2">
                        <svg class="w-6 h-6 text-green-400 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h2.64m-13.5 0L12 14.25m-2.64 0L5.25 21m13.5 0L12 14.25m-2.64 0L5.25 21m13.5 0L12 14.25" /></svg>
                        <div>
                            <label for="direccion" class="text-sm font-semibold text-gray-300">Nombre o dirección de tu tienda</label>
                            <input type="text" id="direccion" name="direccion" placeholder="Ej: Tienda La Esquina" class="w-full p-2 outline-none placeholder-gray-400 text-white form-input-glass-card">
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-17" class="survey-step step-hidden">
                <div class="text-center">
                    <svg class="w-16 h-16 text-green-400 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h2 class="text-3xl font-bold mb-4">¡Mil gracias!</h2>
                    <p class="text-gray-200 mb-6">Tu opinión es oro para nosotros. Estamos construyendo el futuro de Mercacol para tenderos como tú.</p>
                    <p class="text-gray-200">Pronto nos pondremos en contacto. ¡Prepárate para la revolución agrícola en Popayán!</p>
                </div>
            </div>

        </main>

        <footer id="nav-buttons" class="p-6 border-t border-white/20 flex justify-between items-center">
            <button id="btn-prev" class="font-bold py-3 px-6 rounded-full shadow-lg transform transition-all duration-300 bg-transparent text-gray-300 hover:text-white">
                Anterior
            </button>
            <button id="btn-next" class="font-bold py-3 px-6 rounded-full shadow-lg transform transition-all duration-300 bg-green-500 text-white hover:bg-green-600 hover:scale-105 active:scale-95 active:shadow-inner">
                Siguiente
            </button>
            <button id="btn-finish" class="hidden font-bold py-3 px-6 rounded-full shadow-lg transform transition-all duration-300 bg-green-500 text-white hover:bg-green-600 hover:scale-105 active:scale-95 active:shadow-inner">
                Finalizar y Enviar
            </button>
        </footer>
    </div>

    <!-- History Section -->
    <div id="history-section" class="hidden view-section bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl max-w-lg w-full overflow-hidden border border-white/20">
        <header class="p-6 border-b border-white/20 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                </svg>
                <div>
                    <h1 class="text-2xl font-bold text-white">Historial de Pedidos</h1>
                    <p class="text-sm text-green-400">Usuarios registrados</p>
                </div>
            </div>
        </header>
        <main class="p-8" style="max-height: 70vh; overflow-y: auto;">
            <div class="bg-white/5 p-4 rounded-lg border border-white/10 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-white">Exportar Datos</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="start-date" class="text-sm text-gray-300">Fecha de inicio</label>
                        <input type="date" id="start-date" class="w-full p-2 mt-1 rounded-lg border outline-none text-white form-input-glass ring-1 ring-transparent focus:ring-green-400">
                    </div>
                    <div>
                        <label for="end-date" class="text-sm text-gray-300">Fecha de fin</label>
                        <input type="date" id="end-date" class="w-full p-2 mt-1 rounded-lg border outline-none text-white form-input-glass ring-1 ring-transparent focus:ring-green-400">
                    </div>
                </div>
                <div class="flex space-x-4 mt-4">
                    <button id="export-pdf" class="flex-1 flex items-center justify-center space-x-2 font-bold py-3 px-4 rounded-full shadow-lg transform transition-all duration-300 bg-purple-600 text-white hover:bg-purple-700 hover:scale-105 active:scale-95">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 005.625 21h12.75c1.243 0 2.25-1.007 2.25-2.25V11.25a9 9 0 00-9-9z" /></svg>
                        <span>Exportar PDF</span>
                    </button>
                    <button id="export-excel" class="flex-1 flex items-center justify-center space-x-2 font-bold py-3 px-4 rounded-full shadow-lg transform transition-all duration-300 bg-green-600 text-white hover:bg-green-700 hover:scale-105 active:scale-95">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                        <span>Exportar Excel</span>
                    </button>
                </div>
            </div>
            <div id="user-list-container" class="space-y-4">
                <!-- User cards will be injected here by JavaScript -->
                <p class="text-center text-gray-300">Aún no hay usuarios registrados.</p>
            </div>
        </main>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-lg p-4 z-50">
        <div class="bg-gray-900/80 backdrop-blur-xl rounded-full shadow-2xl border border-white/20 flex justify-center items-center max-w-xs mx-auto">
            <button id="history-toggle-button" class="p-3 rounded-full text-green-400 hover:bg-green-500/20 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-50 transition-all duration-300 transform hover:scale-110">
                <svg id="cart-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Survey Navigation Logic
            const surveyWrapper = document.getElementById('survey-wrapper');
            const historySection = document.getElementById('history-section');
            const historyToggleButton = document.getElementById('history-toggle-button');
            const cartIcon = document.getElementById('cart-icon');
            const closeIcon = document.getElementById('close-icon');

            historyToggleButton.addEventListener('click', () => {
                const isHistoryVisible = !historySection.classList.contains('hidden');

                // Remove animation class to reset it
                surveyWrapper.classList.remove('view-section');
                historySection.classList.remove('view-section');

                // Force a reflow to make sure the class removal is registered
                void surveyWrapper.offsetWidth;
                void historySection.offsetWidth;

                if (isHistoryVisible) {
                    // Show survey, hide history
                    surveyWrapper.classList.remove('hidden');
                    historySection.classList.add('hidden');
                    surveyWrapper.classList.add('view-section');
                } else {
                    // Show history, hide survey
                    surveyWrapper.classList.add('hidden');
                    historySection.classList.remove('hidden');
                    historySection.classList.add('view-section');
                }

                cartIcon.classList.toggle('hidden', !isHistoryVisible);
                if (!isHistoryVisible) {
                    displayUsers(); // Fetch and display users when opening history
                }
                closeIcon.classList.toggle('hidden', isHistoryVisible);
            });

            async function displayUsers() {
                const userListContainer = document.getElementById('user-list-container');
                userListContainer.innerHTML = '<p class="text-center text-gray-300">Cargando usuarios...</p>';

                try {
                    const querySnapshot = await db.collection('users').get();
                    if (querySnapshot.empty) {
                        userListContainer.innerHTML = '<p class="text-center text-gray-300">Aún no hay usuarios registrados.</p>';
                        return;
                    }

                    let usersHtml = '';
                    querySnapshot.forEach(doc => {
                        const userData = doc.data();
                        usersHtml += `
                            <div class="bg-white/5 p-4 rounded-lg border border-white/10 shadow-md">
                                <h4 class="text-lg font-bold text-green-400">${userData.nombre_completo || 'Usuario sin nombre'}</h4>
                                <p class="text-sm text-gray-300">${userData.direccion || 'Sin tienda registrada'}</p>
                                <p class="text-sm text-gray-300 mt-1">WhatsApp: ${userData.whatsapp || 'No proporcionado'}</p>
                            </div>
                        `;
                    });
                    userListContainer.innerHTML = usersHtml;

                } catch (error) {
                    console.error("Error al obtener los usuarios:", error);
                    userListContainer.innerHTML = '<p class="text-center text-red-400">Error al cargar los usuarios. Inténtalo de nuevo.</p>';
                }
            }

            // Firebase Initialization
            const firebaseConfig = {
                apiKey: "AIzaSyDSbbkoLdJyX2Ln3GHMkJPE1k3cC9u0Lcw",
                authDomain: "mercacol-448b8.firebaseapp.com",
                projectId: "mercacol-448b8",
                storageBucket: "mercacol-448b8.firebasestorage.app",
                messagingSenderId: "350139377581",
                appId: "1:350139377581:web:1f651cb55c8fb69ba3a324"
            };

            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // Sign in anonymously on page load to allow read access to the database
            auth.signInAnonymously().catch((error) => {
                console.error("Error signing in anonymously:", error);
                alert("No se pudo conectar con la base de datos. Por favor, recarga la página.");
            });

            // Existing Survey Logic
            const steps = document.querySelectorAll('.survey-step');
            const totalSteps = steps.length;
            let currentStep = 1;
            
            const progressBar = document.getElementById('progress-bar');
            const btnNext = document.getElementById('btn-next');
            const btnPrev = document.getElementById('btn-prev');
            const btnFinish = document.getElementById('btn-finish');
            const navButtons = document.getElementById('nav-buttons');
            const surveyData = {};

            const productCatalog = [
                { id: 'tomate', name: 'Tomate Chonto', pricePerKg: 3500 },
                { id: 'papa', name: 'Papa Pastusa', pricePerKg: 2000 },
                { id: 'cebolla', name: 'Cebolla Cabezona', pricePerKg: 2500 },
                { id: 'aguacate', name: 'Aguacate Hass', pricePerKg: 6000, offer: 15 },
                { id: 'zanahoria', name: 'Zanahoria', pricePerKg: 1800 },
                { id: 'platano', name: 'Plátano Verde', pricePerKg: 2200 }
            ];
            let cart = {}; 

            const productListContainer = document.getElementById('demo-product-list');
            const quantityAdjusterContainer = document.getElementById('demo-quantity-adjuster');
            const summaryListContainer = document.getElementById('demo-summary-list');
            const summaryTotalEl = document.getElementById('demo-summary-total');
            const priceListContainer = document.getElementById('demo-price-list');
            
            const btnDemoConfirm = document.getElementById('btn-demo-confirm');
            const btnDemoSummaryConfirm = document.getElementById('btn-demo-summary-confirm');
            const checkIcon = document.getElementById('check-icon');
            const btnConfirmText = document.getElementById('btn-confirm-text');

            function formatCurrency(value) {
                return value.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 });
            }

            function renderProductList() {
                if (!productListContainer) return;
                productListContainer.innerHTML = '';
                productCatalog.forEach(product => {
                    const isSelected = cart.hasOwnProperty(product.id);
                    const selectedClasses = isSelected ? 'ring-2 ring-green-500 shadow-lg' : '';
                    productListContainer.innerHTML += `
                        <div class="product-item w-full h-10 bg-white/20 rounded flex items-center justify-between px-3 cursor-pointer hover:bg-white/30 ${selectedClasses}" data-product-id="${product.id}">
                            <span class="text-sm">${product.name}</span>
                            <span class="text-green-400 font-bold">${isSelected ? '✓' : '+'}</span>
                        </div>
                    `;
                });
            }
            
            function renderQuantityAdjuster() {
                if (!quantityAdjusterContainer) return;
                quantityAdjusterContainer.innerHTML = '';
                const cartItems = Object.keys(cart);

                if (cartItems.length === 0) {
                    quantityAdjusterContainer.innerHTML = `<p class="text-gray-400 text-center m-auto">No has agregado productos.<br>Vuelve al paso anterior para seleccionarlos.</p>`;
                    return;
                }

                cartItems.forEach(productId => {
                    const product = productCatalog.find(p => p.id === productId);
                    const cartItem = cart[productId];
                    quantityAdjusterContainer.innerHTML += `
                        <div class="bg-white/10 p-3 rounded-lg">
                            <h5 class="font-semibold text-center mb-2">${product.name}</h5>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <button class="btn-minus w-8 h-8 rounded-full bg-white/20 text-green-400 text-2xl font-bold flex items-center justify-center" data-product-id="${product.id}">-</button>
                                    <span class="text-2xl font-bold w-12 text-center">${cartItem.quantity}</span>
                                    <button class="btn-plus w-8 h-8 rounded-full bg-green-500 text-white text-2xl font-bold flex items-center justify-center" data-product-id="${product.id}">+</button>
                                </div>
                                <select class="unit-selector bg-gray-700 text-white border-none rounded-md p-1 text-sm focus:ring-green-500" data-product-id="${product.id}">
                                    <option value="kg" ${cartItem.unit === 'kg' ? 'selected' : ''}>Kilos</option>
                                    <option value="lb" ${cartItem.unit === 'lb' ? 'selected' : ''}>Libras</option>
                                </select>
                            </div>
                        </div>
                    `;
                });
            }

            function renderPriceList() {
                if (!priceListContainer) return;
                priceListContainer.innerHTML = '';
                productCatalog.forEach(product => {
                    // Etiqueta de oferta rediseñada
                    const offerTag = product.offer 
                        ? `<div class="bg-green-600 text-white text-xs font-bold px-1.5 py-0.5 rounded-full mb-1">${product.offer}% OFF</div>`
                        : '';

                    priceListContainer.innerHTML += `
                        <div class="w-full flex justify-between items-center bg-white/5 p-2 rounded">
                            <div>
                                ${offerTag}
                                <span>${product.name}</span>
                            </div>
                            <span class="font-medium text-green-300">${formatCurrency(product.pricePerKg)}/kg</span>
                        </div>
                    `;
                });
            }

            function renderSummary() {
                if (!summaryListContainer || !summaryTotalEl) return;
                summaryListContainer.innerHTML = '';
                let total = 0;
                const cartItems = Object.keys(cart);

                if (cartItems.length === 0) {
                     summaryListContainer.innerHTML = `<p class="text-gray-400 text-center m-auto">Tu carrito está vacío.</p>`;
                } else {
                    cartItems.forEach(productId => {
                        const product = productCatalog.find(p => p.id === productId);
                        const cartItem = cart[productId];
                        let price = (cartItem.unit === 'kg') 
                            ? cartItem.quantity * product.pricePerKg 
                            : cartItem.quantity * (product.pricePerKg / 2.20462);
                        
                        if (product.offer) {
                            price *= (1 - product.offer / 100);
                        }
                        
                        total += price;

                        summaryListContainer.innerHTML += `
                            <div class="w-full bg-white/10 rounded flex justify-between p-2">
                                <span>${cartItem.quantity} ${cartItem.unit === 'kg' ? 'Kg' : 'Lb'} ${product.name}</span>
                                <span class="font-medium">${formatCurrency(price)}</span>
                            </div>
                        `;
                    });
                }
                summaryTotalEl.textContent = formatCurrency(total);
            }
            
            function renderAllDemoParts() {
                renderProductList(); 
                renderQuantityAdjuster();
                renderSummary();
                renderPriceList();
            }

            if (productListContainer) {
                productListContainer.addEventListener('click', (e) => {
                    const productItem = e.target.closest('.product-item');
                    if (!productItem) return;
                    const productId = productItem.dataset.productId;
                    if (cart.hasOwnProperty(productId)) {
                        delete cart[productId];
                    } else {
                        cart[productId] = { quantity: 1, unit: 'kg' };
                    }
                    renderAllDemoParts();
                });
            }

            if (quantityAdjusterContainer) {
                quantityAdjusterContainer.addEventListener('click', (e) => {
                    const target = e.target;
                    const productId = target.dataset.productId;
                    if (!productId || !cart[productId]) return;
                    if (target.classList.contains('btn-plus')) {
                        cart[productId].quantity++;
                    }
                    if (target.classList.contains('btn-minus')) {
                        cart[productId].quantity = Math.max(1, cart[productId].quantity - 1);
                    }
                    renderAllDemoParts();
                });

                quantityAdjusterContainer.addEventListener('change', (e) => {
                    const target = e.target;
                    if (target.classList.contains('unit-selector')) {
                        const productId = target.dataset.productId;
                        if (productId && cart[productId]) {
                            cart[productId].unit = target.value;
                            renderAllDemoParts();
                        }
                    }
                });
            }

            const advanceToNextStep = () => {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            };

            if(btnDemoSummaryConfirm) {
                btnDemoSummaryConfirm.addEventListener('click', () => {
                    btnDemoSummaryConfirm.disabled = true;
                    checkIcon.classList.remove('hidden');
                    btnConfirmText.textContent = 'Pedido Confirmado';
                    setTimeout(advanceToNextStep, 800); 
                });
            }
            
            if(btnDemoConfirm) {
                btnDemoConfirm.addEventListener('click', advanceToNextStep);
            }

            function showStep(stepNum) {
                steps.forEach((step, index) => {
                    const stepElement = document.getElementById(`step-${index + 1}`);
                    if (!stepElement) return;
                    if ((index + 1) === stepNum) {
                        stepElement.classList.add('step-visible');
                        stepElement.classList.remove('step-hidden');
                    } else {
                        stepElement.classList.remove('step-visible');
                        stepElement.classList.add('step-hidden');
                    }
                });
                
                // El paso de resumen ahora es el 10
                if (stepNum !== 10 && btnDemoSummaryConfirm) {
                    btnDemoSummaryConfirm.disabled = false;
                    checkIcon.classList.add('hidden');
                    btnConfirmText.textContent = 'Confirmar Pedido';
                }

                const progress = ((stepNum - 1) / (totalSteps - 1)) * 100;
                progressBar.style.width = `${progress}%`;

                btnPrev.classList.toggle('hidden', stepNum === 1);
                
                const hideNextButtonSteps = [10, 11, totalSteps - 1, totalSteps]; 
                btnNext.classList.toggle('hidden', hideNextButtonSteps.includes(stepNum));
                
                btnFinish.classList.toggle('hidden', stepNum !== totalSteps - 1);
                navButtons.classList.toggle('hidden', stepNum === totalSteps);
                
                // El demo ahora va del paso 7 al 12
                if (stepNum >= 7 && stepNum <= 12) {
                    renderAllDemoParts();
                }

                if (stepNum === 12) {
                    startHorizontalTimelineAnimation();
                }
            }

            function collectStepData(stepNum) {
                const stepElement = document.getElementById(`step-${stepNum}`);
                if (!stepElement) return;
                const inputs = stepElement.querySelectorAll('input[name], textarea[name], select[name]');
                inputs.forEach(input => {
                    const name = input.name;
                    if (!name) return;
                    if (input.type === 'radio') {
                        if (input.checked) { surveyData[name] = input.value; }
                    } else if (input.type === 'checkbox') {
                        if (!surveyData[name]) { surveyData[name] = []; }
                        if (input.checked) {
                            if (!surveyData[name].includes(input.value)) { surveyData[name].push(input.value); }
                        } else {
                            const index = surveyData[name].indexOf(input.value);
                            if (index > -1) { surveyData[name].splice(index, 1); }
                        }
                    } else {
                        surveyData[name] = input.value;
                    }
                });
            }

            btnNext.addEventListener('click', () => {
                collectStepData(currentStep);
                if (navigator.vibrate) { // Vibrate on next button click
                    navigator.vibrate(100);
                }
                advanceToNextStep();
            });

            btnPrev.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            function resetSurvey() {
                // Clear all input fields
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type === 'radio' || input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
                // Reset cart and survey data object
                cart = {};
                for (const key in surveyData) {
                    delete surveyData[key];
                }
                // Go back to the first step
                currentStep = 1;
                showStep(1);
            }

            btnFinish.addEventListener('click', async (e) => {
                e.preventDefault();
                collectStepData(currentStep);
                surveyData['pedido_demo'] = cart;

                const nombre = surveyData['nombre_completo'];
                if (!nombre) {
                    alert("Por favor, ingresa tu nombre completo para finalizar.");
                    return;
                }

                btnFinish.disabled = true;
                btnFinish.textContent = 'Enviando...';

                try {
                    const user = auth.currentUser;

                    if (user) {
                         // Add a timestamp to the survey data
                        surveyData.createdAt = firebase.firestore.FieldValue.serverTimestamp();

                        // Save survey data to Firestore, creating a new document in the 'users' collection
                        await db.collection('users').add(surveyData);

                        console.log("Datos guardados exitosamente!");

                        // Show success message and then reset
                        advanceToNextStep(); // Go to the thank you page

                        setTimeout(() => {
                           resetSurvey();
                        }, 4000); // Wait 4 seconds on the thank you page before resetting

                    } else {
                        throw new Error("No se pudo obtener un usuario anónimo.");
                    }

                } catch (error) {
                    console.error("Error durante el envío:", error);
                    // alert(`Hubo un error al enviar tus datos: ${error.message}`);
                } finally {
                    btnFinish.disabled = false;
                    btnFinish.textContent = 'Finalizar y Enviar';
                }
            });

            function startHorizontalTimelineAnimation() {
                const container = document.getElementById('timeline-container-horizontal');
                const deliveryTimeContainer = document.getElementById('delivery-time-container');
                if (!container || !deliveryTimeContainer) return;

                const timelineItems = [
                    {
                        text: 'Preparando pedido',
                        icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" /></svg>`
                    },
                    {
                        text: 'En ruta',
                        icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H3.375A2.25 2.25 0 001.125 6.75v10.5a2.25 2.25 0 002.25 2.25z" /></svg>`
                    },
                    {
                        text: 'Llega hoy',
                        icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`
                    },
                    {
                        text: 'Entregado',
                        icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>`
                    }
                ];

                let htmlContent = '<div class="timeline-horizontal-container">';
                timelineItems.forEach((item, index) => {
                    htmlContent += `
                        <div id="timeline-item-${index}" class="timeline-horizontal-item">
                            <div class="timeline-connector"><div id="timeline-connector-fill-${index}" class="timeline-connector-fill"></div></div>
                            <div id="timeline-node-${index}" class="timeline-node">${item.icon}</div>
                            <div id="timeline-label-${index}" class="timeline-label">${item.text}</div>
                        </div>
                    `;
                });
                htmlContent += '</div>';
                container.innerHTML = htmlContent;
                deliveryTimeContainer.innerHTML = ''; // Clear previous content

                const animateTimeline = () => {
                    let currentStep = 0;

                    function nextStep() {
                        if (currentStep >= timelineItems.length) {
                            // After the last step, show the delivery time
                            const deliveryTime = new Date();
                            const formattedTime = deliveryTime.toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit' });

                            deliveryTimeContainer.innerHTML = `
                                <div class="flex items-center justify-center space-x-2 bg-green-500/10 border border-green-500/30 rounded-full px-4 py-2">
                                    <svg class="w-6 h-6 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                    </svg>
                                    <span class="font-semibold text-white">Entregado a las ${formattedTime}</span>
                                </div>
                            `;
                            deliveryTimeContainer.style.opacity = '1';
                            return;
                        }

                        const item = document.getElementById(`timeline-item-${currentStep}`);
                        if (item) {
                           item.style.opacity = '1';
                           item.style.transform = 'translateY(0)';
                        }

                        const node = document.getElementById(`timeline-node-${currentStep}`);
                        if (node) node.classList.add('active');

                        const label = document.getElementById(`timeline-label-${currentStep}`);
                        if (label) label.classList.add('active');

                        if (currentStep < timelineItems.length) {
                             const nextConnectorFill = document.getElementById(`timeline-connector-fill-${currentStep + 1}`);
                             if (nextConnectorFill) {
                                setTimeout(() => {
                                    nextConnectorFill.style.width = '100%';
                                }, 300);
                             }
                        }

                        currentStep++;
                        setTimeout(nextStep, 800);
                    }
                    setTimeout(nextStep, 200);
                };

                animateTimeline();
            }

            showStep(1);
            renderAllDemoParts();

            // Export Logic
            const btnExportPdf = document.getElementById('export-pdf');
            const btnExportExcel = document.getElementById('export-excel');
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');

            async function fetchUsersForExport(startDate, endDate) {
                try {
                    let query = db.collection('users');

                    if (startDate) {
                        query = query.where('createdAt', '>=', startDate);
                    }
                    if (endDate) {
                        // To include the whole end day, we set the time to 23:59:59
                        const endOfDay = new Date(endDate);
                        endOfDay.setHours(23, 59, 59, 999);
                        query = query.where('createdAt', '<=', endOfDay);
                    }

                    const snapshot = await query.orderBy('createdAt', 'desc').get();

                    if (snapshot.empty) {
                        alert("No hay usuarios registrados en el rango de fechas seleccionado.");
                        return [];
                    }

                    return snapshot.docs.map(doc => doc.data());

                } catch (error) {
                    console.error("Error fetching users for export:", error);
                    alert("Hubo un error al obtener los datos. Revisa la consola para más detalles.");
                    return [];
                }
            }

            function exportToPDF(users) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(20);
                doc.setTextColor(107, 33, 168); // Purple
                doc.text("Reporte de Usuarios Registrados", 15, 20);

                doc.setFontSize(10);
                doc.setTextColor(34, 197, 94); // Green
                doc.text(`Fecha de generación: ${new Date().toLocaleDateString('es-CO')}`, 15, 28);

                const tableColumn = ["Nombre", "WhatsApp", "Correo", "Dirección / Tienda"];
                const tableRows = [];

                users.forEach(user => {
                    const userData = [
                        user.nombre_completo || '',
                        user.whatsapp || '',
                        user.email || '',
                        user.direccion || '',
                    ];
                    tableRows.push(userData);
                });

                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: 35,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [107, 33, 168], // Purple
                        textColor: [255, 255, 255]
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    },
                });

                doc.save('reporte_usuarios_mercadol.pdf');
            }

            function exportToExcel(users) {
                const worksheetData = users.map(user => ({
                    'Nombre': user.nombre_completo || '',
                    'Numero de WhatsApp': user.whatsapp || '',
                    'Correo': user.email || '',
                    'Direccion': user.direccion || '',
                    'Nombre de la Tienda': user.direccion || '' // Assuming direction contains the store name
                }));

                const worksheet = XLSX.utils.json_to_sheet(worksheetData);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Usuarios');

                XLSX.writeFile(workbook, 'reporte_usuarios_mercadol.xlsx');
            }

            btnExportPdf.addEventListener('click', async () => {
                const startDate = startDateInput.value ? new Date(startDateInput.value) : null;
                const endDate = endDateInput.value ? new Date(endDateInput.value) : null;
                const users = await fetchUsersForExport(startDate, endDate);
                if (users.length > 0) {
                    exportToPDF(users);
                }
            });

            btnExportExcel.addEventListener('click', async () => {
                const startDate = startDateInput.value ? new Date(startDateInput.value) : null;
                const endDate = endDateInput.value ? new Date(endDateInput.value) : null;
                const users = await fetchUsersForExport(startDate, endDate);
                if (users.length > 0) {
                    exportToExcel(users);
                }
            });
        });
    </script>
</body>
</html>
